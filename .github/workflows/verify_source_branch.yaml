name: Verify source branch name

on:
  pull_request:
    branches:
      - '**'


jobs:
  verify-source-branch:
    runs-on: ubuntu-latest
    env:
      BRANCH_NAME: ${{ github.head_ref }}  # Set the variables used by the verify_branch script
      VALIDATE_ALL: "True"
    steps:
      - name: Checkout code
        uses: actions/checkout@v6
        with:
          ref: ${{ github.event.pull_request.head.sha }}
          fetch-depth: 0

      - name: Print source branch name
        run: |
          echo "The source branch of the PR is: $BRANCH_NAME"

      - name: Get latest push changes
        id: changed-files
        uses: ./.github/actions/get-changed-files

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: pip install git+https://github.com/hed-standard/hed-python.git@main

      - name: Verify branch naming and changed files
        env:
          ALL_CHANGED_FILES: ${{ steps.changed-files.outputs.all_changed_files }}
        run: |
          echo "Running branch verification..."
          if [ -n "$ALL_CHANGED_FILES" ]; then
            python scripts/verify_branch.py $ALL_CHANGED_FILES --validate-all
          else
            echo "No files have changed."
            exit 0
          fi